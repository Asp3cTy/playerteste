<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload de VÃ­deos</title>
    <script src="https://unpkg.com/vue@3"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen">
    <div id="app" class="bg-gray-800 p-6 rounded-lg shadow-lg w-full max-w-md">
        <h1 class="text-xl font-bold text-center mb-4">ðŸ“¤ Upload de VÃ­deos</h1>
        
        <input type="file" id="videoFile" accept="video/*" class="block w-full mb-4 p-2 bg-gray-700 border border-gray-600 rounded">
        <button @click="uploadVideo" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded w-full">Enviar</button>

        <!-- Barra de Progresso -->
        <div v-if="uploading" class="mt-4">
            <div class="relative w-full h-4 bg-gray-600 rounded overflow-hidden">
                <div class="absolute top-0 left-0 h-full bg-green-500 transition-all" :style="{ width: progress + '%' }"></div>
            </div>
            <p class="text-center mt-2 text-sm">{{ progress }}% Enviado</p>
        </div>

        <p v-if="message" :class="messageClass" class="mt-4 text-center font-semibold">{{ message }}</p>

        <a href="/" class="block text-center mt-4 text-blue-400 hover:underline">ðŸ”™ Voltar para Home</a>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    uploading: false,
                    progress: 0,
                    message: '',
                    messageClass: ''
                };
            },
            methods: {
                uploadVideo() {
                    const fileInput = document.getElementById("videoFile");
                    if (fileInput.files.length === 0) {
                        this.message = "Por favor, selecione um arquivo!";
                        this.messageClass = "text-red-400";
                        return;
                    }

                    const file = fileInput.files[0];
                    const formData = new FormData();
                    formData.append("video", file);

                    this.uploading = true;
                    this.progress = 0;
                    this.message = "Enviando...";
                    this.messageClass = "text-blue-400";

                    const xhr = new XMLHttpRequest();
                    xhr.open("POST", "/upload", true);

                    // Atualiza a barra de progresso
                    xhr.upload.onprogress = (event) => {
                        if (event.lengthComputable) {
                            this.progress = Math.round((event.loaded / event.total) * 100);
                        }
                    };

                    xhr.onload = () => {
                        this.uploading = false;
                        if (xhr.status === 200) {
                            this.message = "Upload concluÃ­do com sucesso!";
                            this.messageClass = "text-green-400";
                            fileInput.value = "";
                            this.progress = 100;
                        } else {
                            this.message = "Erro ao enviar o vÃ­deo!";
                            this.messageClass = "text-red-400";
                        }
                    };

                    xhr.onerror = () => {
                        this.uploading = false;
                        this.message = "Erro na conexÃ£o!";
                        this.messageClass = "text-red-400";
                    };

                    xhr.send(formData);
                }
            }
        }).mount("#app");
    </script>
</body>
</html>
